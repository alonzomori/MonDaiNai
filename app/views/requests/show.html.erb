<div class="container" id="request_show">
  <%= render "shared/navbar-back-menu" %>
  <div>
    <h1>Chat with <%= current_user == @request.user ? @request.item.user.name : @request.user.name %></h1>
    <%= turbo_stream_from @request %>
    <!-- Calendar -->
    <% if @request.available_times == nil %>
      <% if current_user == @request.user %>
        <%= simple_form_for(@request) do |f| %>
          <div class="d-flex flex-column text-center align-items-center" data-controller="pickup">
            <div class="form-group">
              <h2 class="mt-3">Select your pickup date</h2>
              <%= f.input :pickup_date,
                label: " ",
                as: :string,
                input_html: { data: { controller: "flatpickr", flatpickr_min_date_value: @request.item.available_date, flatpickr_max_date_value: @request.item.deadline_date} },
                wrapper_html: { class: "text-center disabled"} %>
            </div>
            <% if @request.pickup_date %>
              <p> <%= @request.user.name %>! The pickup date is on <%= @request.pickup_date %>!</p>
            <% end %>
            <!-- Available times -->
            <h3>Select hours when you'll be available</h3>
            <%= f.input :available_times, collection: 8..21, as: :check_boxes, wrapper_html: { class: " d-flex flex-row gap-2" }, input_html: { class: "d-flex flex-column border-secondary ms-0" } %>
            <%# SELECT PICK UP DATE BUTTON %>
            <%= f.button :submit, "Select Pickup Date",
            class: "btn btn-primary rounded-3 text-white mt-3" %>
            <p class="mt-3 text-success fw-bold" data-pickup-target="message"></p>
          </div>
        <% end %>
      <% end %>
    <% elsif @request.pickup_date.hour == 0 && @request.user != current_user %>
      <%# Available times radio buttons %>
      <div class="text-center mb-3">
        <%= simple_form_for(@request) do |f| %>
          <%= hidden_field_tag :confirm_time, true %>
          <h3 class="mt-3">Select the hour for pickup</h3>
          <%= f.input :pickup_date, label: "Select pickup time", collection: @request.available_times, as: :radio_buttons, wrapper_html: { class: " d-flex flex-row gap-2 justify-content-center" }, input_html: { class: "d-flex flex-column border-secondary ms-0" } %>
          <%= f.submit "Confirm pickup time", class: "btn btn-primary rounded-3 text-white" %>
        <% end %>
      </div>
    <% elsif @request.pickup_date.hour != 0 %>
      <div class="d-flex flex-column align-items-center gap-1 justify-content-center mt-3">
        <h2>Pickup date is: </h2>
        <h2><%= @request.pickup_date.strftime('%D at %H:%M') %></h2>
      </div>
    <% end %>
    <div id="messages" class="w-100 justify-content-center">
      <%# GOOGLE MAPS LOCATION %>
      <div class="w-100 d-flex justify-content-center">
        <%= link_to "Google maps location", "https://www.google.com/maps/preview?q=#{@request.item.location}",
        class:"btn secondary-button text-primary border-primary rounded-3 mx-auto my-3", target: :_blank %>
      </div>
      <% @request.messages.each do |message| %>
        <%= render "messages/message", {message: message, user: current_user} %>
      <% end %>
    </div>
    <div class="my-3 w-100">
      <%= simple_form_for [@request, @message], html: { class: "d-flex align-items-center w-100" } do |f| %>
        <%= f.text_field :content,
        class: "form-control me-2 rounded-3 border-primary bg-white flex-grow-2",
        placeholder: "Enter your message"
    %>
        <%= f.submit "Send", class: "btn btn-primary rounded-3 text-white" %>
      <% end %>
    </div>
  </div>
</div>
</div>
